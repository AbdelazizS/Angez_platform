import{u as _,J as D,r as v,j as e,S as $,b as y}from"./app-tu_nxz4H.js";import{B as T}from"./button-BZgJU16f.js";import{T as I}from"./textarea-BFctAIp6.js";import{L as S}from"./label-rORxKIBW.js";import{C as p,a as C,b as M,c as w}from"./card-Bw0vLuEn.js";import{u as V}from"./index.esm-D4L61ild.js";import{S as L}from"./star-BhuApNjd.js";import{L as q}from"./loader-circle-CylYfSfh.js";import{A as B,a as H,b as U}from"./avatar-Br7MV_1H.js";import"./dropdown-menu-XeOzj3G4.js";import{S as r}from"./skeleton-CNspO5WR.js";function se({orderId:a,onSuccess:i}){var g,b;const{t}=_(),{errors:s}=D().props,[u,h]=v.useState(null),[j,c]=v.useState(!1),{register:l,handleSubmit:o,setValue:d,watch:m,formState:{errors:x}}=V({defaultValues:{rating:5,comment:""}}),N=m("rating"),f=m("comment"),A=n=>{d("rating",n,{shouldValidate:!0})},F=async n=>{c(!0);try{await $.post(`/client/orders/${a}/review`,n,{onSuccess:()=>{y.success(t("reviews.submitted"),{description:t("reviews.thank_you")}),i==null||i()},onError:z=>{const k=(s==null?void 0:s.rating)||(s==null?void 0:s.comment)||(s==null?void 0:s.review)||t("reviews.submit_error");y.error(t("reviews.submission_failed"),{description:k})},preserveScroll:!0})}finally{c(!1)}};return e.jsxs(p,{className:"w-full max-w-2xl mt-4 p-4",children:[e.jsx(C,{children:e.jsx(M,{className:"text-lg",children:t("reviews.leave_review")})}),e.jsx(w,{children:e.jsxs("form",{onSubmit:o(F),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"rating",children:t("reviews.rating")}),e.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(n=>e.jsx("button",{type:"button",className:"relative",onClick:()=>A(n),onMouseEnter:()=>h(n),onMouseLeave:()=>h(null),"aria-label":`Rate ${n} star${n!==1?"s":""}`,children:e.jsx(L,{className:`h-8 w-8 transition-colors ${(u??N)>=n?"fill-yellow-400 text-yellow-400":"text-muted-foreground"}`})},n)),e.jsxs("span",{className:"text-sm text-muted-foreground ms-2",children:[N,"/5"]})]}),(x.rating||(s==null?void 0:s.rating))&&e.jsx("p",{className:"text-sm text-destructive",children:((g=x.rating)==null?void 0:g.message)||(s==null?void 0:s.rating)}),e.jsx("input",{type:"hidden",...l("rating",{valueAsNumber:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"comment",children:t("reviews.comment")}),e.jsx(I,{id:"comment",...l("comment",{required:t("reviews.comment_required"),minLength:{value:10,message:t("reviews.comment_min_length")},maxLength:{value:2e3,message:t("reviews.comment_max_length")}}),placeholder:t("reviews.comment_placeholder"),className:"min-h-[120px]"}),e.jsxs("div",{className:"flex justify-between items-center",children:[(x.comment||(s==null?void 0:s.comment))&&e.jsx("p",{className:"text-sm text-destructive",children:((b=x.comment)==null?void 0:b.message)||(s==null?void 0:s.comment)}),e.jsxs("span",{className:"text-xs text-muted-foreground ms-auto",children:[(f==null?void 0:f.length)||0,"/2000"]})]})]}),(s==null?void 0:s.review)&&e.jsx("p",{className:"text-sm text-destructive",children:s.review}),e.jsx(T,{type:"submit",disabled:j,className:"w-full sm:w-auto",children:j?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"me-2 h-4 w-4 animate-spin"}),t("reviews.submitting")]}):t("reviews.submit")})]})})]})}function J(){return e.jsx(p,{className:"w-full",children:e.jsxs(w,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(r,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{className:"h-4 w-[120px]"}),e.jsx(r,{className:"h-3 w-[80px]"})]})]}),e.jsx(r,{className:"h-4 w-full"}),e.jsx(r,{className:"h-4 w-[70%]"})]})})}function R({rating:a}){return e.jsxs("div",{className:"flex items-center gap-1",children:[[...Array(5)].map((i,t)=>e.jsx(L,{className:`h-4 w-4 ${t<a?"fill-yellow-400 text-yellow-400":"text-muted-foreground"}`},t)),e.jsx("span",{className:"text-sm text-muted-foreground ms-1",children:a.toFixed(1)})]})}function te({review:a,compact:i=!1,loading:t=!1}){var l,o,d,m;const{t:s,i18n:u}=_(),[h,j]=v.useState(!1);if(console.log(a),t)return e.jsx(J,{});if(!a)return null;const c=new Date(a.created_at).toLocaleDateString(u.language,{year:"numeric",month:"short",day:"numeric"});return e.jsxs(p,{className:"w-full max-w-2xl hover:shadow-sm transition-shadow mt-4",children:[e.jsx(C,{className:"p-4 pb-2",children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs(B,{className:"h-9 w-9 me-2",children:[e.jsx(H,{src:(l=a.client)==null?void 0:l.avatar}),e.jsx(U,{children:((d=(o=a.client)==null?void 0:o.name)==null?void 0:d.charAt(0).toUpperCase())||"U"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-sm",children:((m=a.client)==null?void 0:m.name)||s("reviews.anonymous")}),!i&&e.jsx(R,{rating:a.rating})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c})]})]})})}),e.jsxs(w,{className:"p-4 pt-0",children:[i&&e.jsx("div",{className:"mb-2",children:e.jsx(R,{rating:a.rating})}),e.jsx("p",{className:"text-sm text-foreground",children:a.comment})]})]})}export{se as R,te as a};
