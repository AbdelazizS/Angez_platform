import{c as Te,r as l,j as e,u as st,S as E,Q as ot,C as le,t as Se}from"./app-tu_nxz4H.js";import{u as B,c as Ie,B as M}from"./button-BZgJU16f.js";import{I as nt}from"./input--XoPGThR.js";import{A as ye,a as je,b as Ne}from"./avatar-Br7MV_1H.js";import{B as re}from"./badge-YbPNhPcJ.js";import{D as lt,a as at,b as it,e as Y}from"./dropdown-menu-XeOzj3G4.js";import{T as ct,m as Ce,n as Pe,o as Re}from"./AppHeader-B8kkmwh_.js";import{P as V}from"./index-CZg7sQom.js";import{P as G}from"./index-Bzb9Ony0.js";import{c as dt,b as H,u as ut}from"./index-CPefrJt7.js";import{u as F}from"./index-CUWVWZD9.js";import{a as mt}from"./index-DEJTFC4Z.js";import{c as ht}from"./index-BdQq_4o_.js";import{C as ft}from"./ClientDashboardLayout-B2cJUFaN.js";import{F as pt}from"./FreelancerDashboardLayout-Drmnvfzb.js";import{A as xt}from"./AdminLayout-Dmogl9Wd.js";import{R as bt,a as vt}from"./ReviewCard-DPuyNaH6.js";import{A as gt}from"./index-Dx2ImkKf.js";import{m as U}from"./proxy-CXAJgvNI.js";import{X as se}from"./sheet-2K7jSFhM.js";import{U as _e}from"./user-BTZAhoSQ.js";import{E as wt}from"./ellipsis-B0AmQ1B-.js";import{P as ke}from"./play-D6LLLLpf.js";import{S as q}from"./send-DjQ49j8w.js";import{R as St}from"./repeat-DFtFnNoH.js";import{L as yt}from"./lock-j5fhUESi.js";import{D as Ee}from"./download-ynPO2CN2.js";import{C as jt}from"./check-check-C_x4iHLW.js";import{C as Nt}from"./index-Du654uGJ.js";import{C as Ct}from"./circle-slash-DazBCOcu.js";import{C as Pt}from"./circle-alert-DXhyxmSK.js";import{C as Rt}from"./clock-BbigxC4A.js";import"./chevron-right-DdsKMi0-.js";import"./LanguageDropdown-Czorzu0A.js";import"./loader-circle-CylYfSfh.js";import"./chevron-down-DgvoPxKv.js";import"./log-out-C_P4AYsR.js";import"./separator-C-d7tlPr.js";import"./skeleton-CNspO5WR.js";import"./index-C4bozPq7.js";import"./search-CMb3RvSH.js";import"./package-C35wEl39.js";import"./message-square-BLldBHH5.js";import"./file-text-CsIm62FH.js";import"./wallet-df-tNZSa.js";import"./shield-Lne4-C57.js";import"./briefcase-uRVTc7Lp.js";import"./credit-card-Bb6y7JVl.js";import"./users-CR2iJthz.js";import"./textarea-BFctAIp6.js";import"./label-rORxKIBW.js";import"./card-Bw0vLuEn.js";import"./index.esm-D4L61ild.js";import"./star-BhuApNjd.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],oe=Te("file",_t);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],At=Te("paperclip",Et);function Tt(t,r){return l.useReducer((o,s)=>r[o][s]??o,t)}var ae="ScrollArea",[Le,Vr]=dt(ae),[It,_]=Le(ae),De=l.forwardRef((t,r)=>{const{__scopeScrollArea:o,type:s="hover",dir:n,scrollHideDelay:a=600,...i}=t,[d,c]=l.useState(null),[h,u]=l.useState(null),[f,m]=l.useState(null),[x,j]=l.useState(null),[P,I]=l.useState(null),[C,A]=l.useState(0),[R,L]=l.useState(0),[D,k]=l.useState(!1),[O,z]=l.useState(!1),v=B(r,N=>c(N)),y=mt(n);return e.jsx(It,{scope:o,type:s,dir:y,scrollHideDelay:a,scrollArea:d,viewport:h,onViewportChange:u,content:f,onContentChange:m,scrollbarX:x,onScrollbarXChange:j,scrollbarXEnabled:D,onScrollbarXEnabledChange:k,scrollbarY:P,onScrollbarYChange:I,scrollbarYEnabled:O,onScrollbarYEnabledChange:z,onCornerWidthChange:A,onCornerHeightChange:L,children:e.jsx(V.div,{dir:y,...i,ref:v,style:{position:"relative","--radix-scroll-area-corner-width":C+"px","--radix-scroll-area-corner-height":R+"px",...t.style}})})});De.displayName=ae;var ze="ScrollAreaViewport",We=l.forwardRef((t,r)=>{const{__scopeScrollArea:o,children:s,nonce:n,...a}=t,i=_(ze,o),d=l.useRef(null),c=B(r,d,i.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),e.jsx(V.div,{"data-radix-scroll-area-viewport":"",...a,ref:c,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:s})})]})});We.displayName=ze;var T="ScrollAreaScrollbar",ie=l.forwardRef((t,r)=>{const{forceMount:o,...s}=t,n=_(T,t.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:i}=n,d=t.orientation==="horizontal";return l.useEffect(()=>(d?a(!0):i(!0),()=>{d?a(!1):i(!1)}),[d,a,i]),n.type==="hover"?e.jsx(kt,{...s,ref:r,forceMount:o}):n.type==="scroll"?e.jsx(Lt,{...s,ref:r,forceMount:o}):n.type==="auto"?e.jsx(Me,{...s,ref:r,forceMount:o}):n.type==="always"?e.jsx(ce,{...s,ref:r}):null});ie.displayName=T;var kt=l.forwardRef((t,r)=>{const{forceMount:o,...s}=t,n=_(T,t.__scopeScrollArea),[a,i]=l.useState(!1);return l.useEffect(()=>{const d=n.scrollArea;let c=0;if(d){const h=()=>{window.clearTimeout(c),i(!0)},u=()=>{c=window.setTimeout(()=>i(!1),n.scrollHideDelay)};return d.addEventListener("pointerenter",h),d.addEventListener("pointerleave",u),()=>{window.clearTimeout(c),d.removeEventListener("pointerenter",h),d.removeEventListener("pointerleave",u)}}},[n.scrollArea,n.scrollHideDelay]),e.jsx(G,{present:o||a,children:e.jsx(Me,{"data-state":a?"visible":"hidden",...s,ref:r})})}),Lt=l.forwardRef((t,r)=>{const{forceMount:o,...s}=t,n=_(T,t.__scopeScrollArea),a=t.orientation==="horizontal",i=K(()=>c("SCROLL_END"),100),[d,c]=Tt("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return l.useEffect(()=>{if(d==="idle"){const h=window.setTimeout(()=>c("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(h)}},[d,n.scrollHideDelay,c]),l.useEffect(()=>{const h=n.viewport,u=a?"scrollLeft":"scrollTop";if(h){let f=h[u];const m=()=>{const x=h[u];f!==x&&(c("SCROLL"),i()),f=x};return h.addEventListener("scroll",m),()=>h.removeEventListener("scroll",m)}},[n.viewport,a,c,i]),e.jsx(G,{present:o||d!=="hidden",children:e.jsx(ce,{"data-state":d==="hidden"?"hidden":"visible",...s,ref:r,onPointerEnter:H(t.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:H(t.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),Me=l.forwardRef((t,r)=>{const o=_(T,t.__scopeScrollArea),{forceMount:s,...n}=t,[a,i]=l.useState(!1),d=t.orientation==="horizontal",c=K(()=>{if(o.viewport){const h=o.viewport.offsetWidth<o.viewport.scrollWidth,u=o.viewport.offsetHeight<o.viewport.scrollHeight;i(d?h:u)}},10);return X(o.viewport,c),X(o.content,c),e.jsx(G,{present:s||a,children:e.jsx(ce,{"data-state":a?"visible":"hidden",...n,ref:r})})}),ce=l.forwardRef((t,r)=>{const{orientation:o="vertical",...s}=t,n=_(T,t.__scopeScrollArea),a=l.useRef(null),i=l.useRef(0),[d,c]=l.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),h=Xe(d.viewport,d.content),u={...s,sizes:d,onSizesChange:c,hasThumb:h>0&&h<1,onThumbChange:m=>a.current=m,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:m=>i.current=m};function f(m,x){return Ht(m,i.current,d,x)}return o==="horizontal"?e.jsx(Dt,{...u,ref:r,onThumbPositionChange:()=>{if(n.viewport&&a.current){const m=n.viewport.scrollLeft,x=Ae(m,d,n.dir);a.current.style.transform=`translate3d(${x}px, 0, 0)`}},onWheelScroll:m=>{n.viewport&&(n.viewport.scrollLeft=m)},onDragScroll:m=>{n.viewport&&(n.viewport.scrollLeft=f(m,n.dir))}}):o==="vertical"?e.jsx(zt,{...u,ref:r,onThumbPositionChange:()=>{if(n.viewport&&a.current){const m=n.viewport.scrollTop,x=Ae(m,d);a.current.style.transform=`translate3d(0, ${x}px, 0)`}},onWheelScroll:m=>{n.viewport&&(n.viewport.scrollTop=m)},onDragScroll:m=>{n.viewport&&(n.viewport.scrollTop=f(m))}}):null}),Dt=l.forwardRef((t,r)=>{const{sizes:o,onSizesChange:s,...n}=t,a=_(T,t.__scopeScrollArea),[i,d]=l.useState(),c=l.useRef(null),h=B(r,c,a.onScrollbarXChange);return l.useEffect(()=>{c.current&&d(getComputedStyle(c.current))},[c]),e.jsx(He,{"data-orientation":"horizontal",...n,ref:h,sizes:o,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Z(o)+"px",...t.style},onThumbPointerDown:u=>t.onThumbPointerDown(u.x),onDragScroll:u=>t.onDragScroll(u.x),onWheelScroll:(u,f)=>{if(a.viewport){const m=a.viewport.scrollLeft+u.deltaX;t.onWheelScroll(m),Ye(m,f)&&u.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&s({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:Q(i.paddingLeft),paddingEnd:Q(i.paddingRight)}})}})}),zt=l.forwardRef((t,r)=>{const{sizes:o,onSizesChange:s,...n}=t,a=_(T,t.__scopeScrollArea),[i,d]=l.useState(),c=l.useRef(null),h=B(r,c,a.onScrollbarYChange);return l.useEffect(()=>{c.current&&d(getComputedStyle(c.current))},[c]),e.jsx(He,{"data-orientation":"vertical",...n,ref:h,sizes:o,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Z(o)+"px",...t.style},onThumbPointerDown:u=>t.onThumbPointerDown(u.y),onDragScroll:u=>t.onDragScroll(u.y),onWheelScroll:(u,f)=>{if(a.viewport){const m=a.viewport.scrollTop+u.deltaY;t.onWheelScroll(m),Ye(m,f)&&u.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&s({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:Q(i.paddingTop),paddingEnd:Q(i.paddingBottom)}})}})}),[Wt,Fe]=Le(T),He=l.forwardRef((t,r)=>{const{__scopeScrollArea:o,sizes:s,hasThumb:n,onThumbChange:a,onThumbPointerUp:i,onThumbPointerDown:d,onThumbPositionChange:c,onDragScroll:h,onWheelScroll:u,onResize:f,...m}=t,x=_(T,o),[j,P]=l.useState(null),I=B(r,v=>P(v)),C=l.useRef(null),A=l.useRef(""),R=x.viewport,L=s.content-s.viewport,D=F(u),k=F(c),O=K(f,10);function z(v){if(C.current){const y=v.clientX-C.current.left,N=v.clientY-C.current.top;h({x:y,y:N})}}return l.useEffect(()=>{const v=y=>{const N=y.target;(j==null?void 0:j.contains(N))&&D(y,L)};return document.addEventListener("wheel",v,{passive:!1}),()=>document.removeEventListener("wheel",v,{passive:!1})},[R,j,L,D]),l.useEffect(k,[s,k]),X(j,O),X(x.content,O),e.jsx(Wt,{scope:o,scrollbar:j,hasThumb:n,onThumbChange:F(a),onThumbPointerUp:F(i),onThumbPositionChange:k,onThumbPointerDown:F(d),children:e.jsx(V.div,{...m,ref:I,style:{position:"absolute",...m.style},onPointerDown:H(t.onPointerDown,v=>{v.button===0&&(v.target.setPointerCapture(v.pointerId),C.current=j.getBoundingClientRect(),A.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),z(v))}),onPointerMove:H(t.onPointerMove,z),onPointerUp:H(t.onPointerUp,v=>{const y=v.target;y.hasPointerCapture(v.pointerId)&&y.releasePointerCapture(v.pointerId),document.body.style.webkitUserSelect=A.current,x.viewport&&(x.viewport.style.scrollBehavior=""),C.current=null})})})}),J="ScrollAreaThumb",Oe=l.forwardRef((t,r)=>{const{forceMount:o,...s}=t,n=Fe(J,t.__scopeScrollArea);return e.jsx(G,{present:o||n.hasThumb,children:e.jsx(Mt,{ref:r,...s})})}),Mt=l.forwardRef((t,r)=>{const{__scopeScrollArea:o,style:s,...n}=t,a=_(J,o),i=Fe(J,o),{onThumbPositionChange:d}=i,c=B(r,f=>i.onThumbChange(f)),h=l.useRef(void 0),u=K(()=>{h.current&&(h.current(),h.current=void 0)},100);return l.useEffect(()=>{const f=a.viewport;if(f){const m=()=>{if(u(),!h.current){const x=Ot(f,d);h.current=x,d()}};return d(),f.addEventListener("scroll",m),()=>f.removeEventListener("scroll",m)}},[a.viewport,u,d]),e.jsx(V.div,{"data-state":i.hasThumb?"visible":"hidden",...n,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:H(t.onPointerDownCapture,f=>{const x=f.target.getBoundingClientRect(),j=f.clientX-x.left,P=f.clientY-x.top;i.onThumbPointerDown({x:j,y:P})}),onPointerUp:H(t.onPointerUp,i.onThumbPointerUp)})});Oe.displayName=J;var de="ScrollAreaCorner",$e=l.forwardRef((t,r)=>{const o=_(de,t.__scopeScrollArea),s=!!(o.scrollbarX&&o.scrollbarY);return o.type!=="scroll"&&s?e.jsx(Ft,{...t,ref:r}):null});$e.displayName=de;var Ft=l.forwardRef((t,r)=>{const{__scopeScrollArea:o,...s}=t,n=_(de,o),[a,i]=l.useState(0),[d,c]=l.useState(0),h=!!(a&&d);return X(n.scrollbarX,()=>{var f;const u=((f=n.scrollbarX)==null?void 0:f.offsetHeight)||0;n.onCornerHeightChange(u),c(u)}),X(n.scrollbarY,()=>{var f;const u=((f=n.scrollbarY)==null?void 0:f.offsetWidth)||0;n.onCornerWidthChange(u),i(u)}),h?e.jsx(V.div,{...s,ref:r,style:{width:a,height:d,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function Q(t){return t?parseInt(t,10):0}function Xe(t,r){const o=t/r;return isNaN(o)?0:o}function Z(t){const r=Xe(t.viewport,t.content),o=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,s=(t.scrollbar.size-o)*r;return Math.max(s,18)}function Ht(t,r,o,s="ltr"){const n=Z(o),a=n/2,i=r||a,d=n-i,c=o.scrollbar.paddingStart+i,h=o.scrollbar.size-o.scrollbar.paddingEnd-d,u=o.content-o.viewport,f=s==="ltr"?[0,u]:[u*-1,0];return Be([c,h],f)(t)}function Ae(t,r,o="ltr"){const s=Z(r),n=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,a=r.scrollbar.size-n,i=r.content-r.viewport,d=a-s,c=o==="ltr"?[0,i]:[i*-1,0],h=ht(t,c);return Be([0,i],[0,d])(h)}function Be(t,r){return o=>{if(t[0]===t[1]||r[0]===r[1])return r[0];const s=(r[1]-r[0])/(t[1]-t[0]);return r[0]+s*(o-t[0])}}function Ye(t,r){return t>0&&t<r}var Ot=(t,r=()=>{})=>{let o={left:t.scrollLeft,top:t.scrollTop},s=0;return function n(){const a={left:t.scrollLeft,top:t.scrollTop},i=o.left!==a.left,d=o.top!==a.top;(i||d)&&r(),o=a,s=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(s)};function K(t,r){const o=F(t),s=l.useRef(0);return l.useEffect(()=>()=>window.clearTimeout(s.current),[]),l.useCallback(()=>{window.clearTimeout(s.current),s.current=window.setTimeout(o,r)},[o,r])}function X(t,r){const o=F(r);ut(()=>{let s=0;if(t){const n=new ResizeObserver(()=>{cancelAnimationFrame(s),s=window.requestAnimationFrame(o)});return n.observe(t),()=>{window.cancelAnimationFrame(s),n.unobserve(t)}}},[t,o])}var Ve=De,$t=We,Xt=$e;const Ue=l.forwardRef(({className:t,children:r,...o},s)=>e.jsxs(Ve,{ref:s,className:Ie("relative overflow-hidden",t),...o,children:[e.jsx($t,{className:"h-full w-full rounded-[inherit]",children:r}),e.jsx(qe,{}),e.jsx(Xt,{})]}));Ue.displayName=Ve.displayName;const qe=l.forwardRef(({className:t,orientation:r="vertical",...o},s)=>e.jsx(ie,{ref:s,orientation:r,className:Ie("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...o,children:e.jsx(Oe,{className:"relative flex-1 rounded-full bg-border"})}));qe.displayName=ie.displayName;const ne={pending:{icon:e.jsx(Rt,{className:"w-4 h-4 text-yellow-500"}),color:"bg-yellow-100 text-yellow-800"},payment_verified:{icon:e.jsx(le,{className:"w-4 h-4 text-blue-500"}),color:"bg-blue-100 text-blue-800"},in_progress:{icon:e.jsx(ke,{className:"w-4 h-4 text-primary"}),color:"bg-primary/10 text-primary"},review:{icon:e.jsx(Pt,{className:"w-4 h-4 text-purple-500"}),color:"bg-purple-100 text-purple-800"},completed:{icon:e.jsx(le,{className:"w-4 h-4 text-green-500"}),color:"bg-green-100 text-green-800"},cancelled:{icon:e.jsx(Ct,{className:"w-4 h-4 text-red-500"}),color:"bg-red-100 text-red-800"}};function Ur({auth:t,order:r,messages:o}){var fe,pe,xe,be,ve;const{t:s}=st(),[n,a]=l.useState(o||[]),[i,d]=l.useState(""),[c,h]=l.useState(null),[u,f]=l.useState(null),[m,x]=l.useState(!1),[j,P]=l.useState(!1),[I,C]=l.useState(null),[A,R]=l.useState({message:"",type:"success"}),L=l.useRef(null),D=l.useRef(null),[k,O]=l.useState([]),z=(fe=t==null?void 0:t.user)==null?void 0:fe.role,v=z==="client",y=z==="freelancer",N=y?r.client:r.freelancer,ee=v?ft:y?pt:xt,g=!(!["completed","cancelled"].includes(r==null?void 0:r.status)&&(r==null?void 0:r.payment_status)!=="failed");l.useEffect(()=>{if(A.message){const p=setTimeout(()=>R({message:"",type:"success"}),5e3);return()=>clearTimeout(p)}},[A]),l.useEffect(()=>{var b;if(n.length===0)return;n.filter(S=>S.sender_id!==t.user.id&&!S.read_at).length>0&&((b=L.current)==null||b.scrollIntoView({behavior:"smooth"}))},[n,t.user.id]),l.useEffect(()=>{if(g||!r)return;const p=()=>{document.visibilityState==="visible"&&E.reload({only:["messages"],preserveScroll:!0,onSuccess:W=>{W.props.messages&&a(W.props.messages)}})},b=setInterval(p,3e3),S=()=>{document.visibilityState==="visible"&&p()};return document.addEventListener("visibilitychange",S),()=>{clearInterval(b),document.removeEventListener("visibilitychange",S)}},[r,g]),l.useEffect(()=>{if(g||!r||!n.length)return;const p=n.filter(b=>b.sender_id!==t.user.id&&!b.read_at).map(b=>b.id);p.length>0&&JSON.stringify(p)!==JSON.stringify(k)&&(O(p),E.post(route("chat.markRead",r.id),{ids:p},{preserveScroll:!0}))},[r,n,t.user.id,k,g]);const Je=p=>{if(g)return;const b=p.target.files[0];if(b)if(h(b),b.type.startsWith("image/")){if(f("image"),b.size<5*1024*1024){const S=new FileReader;S.onload=W=>C(W.target.result),S.readAsDataURL(b)}}else f("doc")},Qe=async p=>{if(p.preventDefault(),g||!i.trim()&&!c)return;x(!0);const b=new FormData;i.trim()&&b.append("content",i),c&&(b.append("file",c),b.append("file_type",u));try{await E.post(route("chat.send",r.id),b,{forceFormData:!0,onSuccess:S=>{d(""),h(null),f(null),C(null),S.props.messages&&a(S.props.messages)}})}finally{x(!1)}},ue=async()=>{if(!g){P(!0);try{await E.post(`/freelancer/orders/${r.id}/deliver-work`,{},{onSuccess:()=>{R({message:s("chatIndex.workDelivered"),type:"success"}),E.reload({only:["order","messages"]})},onError:()=>{R({message:s("chatIndex.failedDeliverWork"),type:"error"})}})}finally{P(!1)}}},Ge=async()=>{if(!g){P(!0);try{await E.post(route("orders.request-revision",r.id),{},{onSuccess:()=>{R({message:s("chatIndex.revisionRequested"),type:"success"}),E.reload({only:["order","messages"]})},onError:()=>{R({message:s("chatIndex.failedRequestRevision"),type:"error"})}})}finally{P(!1)}}},Ze=async()=>{if(!g){P(!0);try{await E.post(`/orders/${r.id}/confirm-completion`,{},{onSuccess:()=>{R({message:s("chatIndex.orderCompleted"),type:"success"}),E.reload({only:["order","messages"]})},onError:()=>{R({message:s("chatIndex.failedConfirmCompletion"),type:"error"})}})}finally{P(!1)}}},Ke=p=>p?new Date(p).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",te=[];let me=null,$=null;if(n.forEach((p,b)=>{p.sender_id!==me?($&&te.push($),$={sender_id:p.sender_id,sender:p.sender,messages:[p]},me=p.sender_id):$.messages.push(p),b===n.length-1&&$&&te.push($)}),!r)return e.jsx(ee,{children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:s("chatIndex.orderNotFoundTitle")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("chatIndex.orderNotFoundDesc")})]})})});const{can_review:et,waiting_review:Yt,review:he}=r,tt=()=>r.status==="completed"?s("chatIndex.disabledReasonCompleted"):r.status==="cancelled"?s("chatIndex.disabledReasonCancelled"):r.payment_status==="failed"?s("chatIndex.disabledReasonPaymentFailed"):s("chatIndex.disabledReasonGeneric");return e.jsx(ct,{children:e.jsxs(ee,{noPadding:!0,children:[e.jsx(ot,{title:s("chatIndex.title",{order:r.order_number})}),e.jsx(gt,{children:A.message&&e.jsx(U.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`fixed top-4 right-4 z-50 px-4 py-2 rounded-md shadow-lg ${A.type==="success"?"bg-green-600":"bg-red-600"} text-white`,children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("span",{children:A.message}),e.jsx("button",{onClick:()=>R({message:"",type:"success"}),children:e.jsx(se,{className:"w-4 h-4"})})]})})}),e.jsxs("div",{className:`flex flex-col  bg-background border-red-500 ${g?"h-[calc(80vh-64px)]":"h-[calc(90vh-64px)]"}`,children:[e.jsxs("div",{className:"border-b border-border p-4 flex items-center justify-between bg-card",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(ye,{className:"h-10 w-10 me-2",children:[e.jsx(je,{src:N==null?void 0:N.avatar}),e.jsx(Ne,{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:((pe=N==null?void 0:N.name)==null?void 0:pe.charAt(0))||e.jsx(_e,{className:"w-5 h-5"})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:(N==null?void 0:N.name)||s("chatIndex.unknownUser")}),e.jsxs("div",{className:"flex items-center ",children:[e.jsx(re,{variant:"outline",className:"text-xs capitalize me-2",children:v?s("auth.freelancer"):y?s("auth.client"):""}),e.jsx(re,{variant:"outline",className:((xe=ne[r.status])==null?void 0:xe.color)+" text-xs",children:s(`orders.status.${r.status}`)})]})]})]}),e.jsxs(lt,{children:[e.jsx(at,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"icon",className:"rounded-full",children:e.jsx(wt,{className:"w-5 h-5"})})}),e.jsxs(it,{align:"start",className:"w-56",children:[y&&(r.status==="payment_verified"||r.status==="review")&&e.jsxs(Y,{onClick:()=>E.post(route("freelancer.orders.updateStatus",r.id),{status:"in_progress"}),disabled:j||g,children:[e.jsx(ke,{className:"w-4 h-4 me-2"}),s("ordersList.markAsInProgress")]}),y&&r.status==="in_progress"&&e.jsxs(Y,{onClick:ue,disabled:j||g,children:[e.jsx(q,{className:"w-4 h-4 me-2"}),s("ordersList.deliverWork")]}),v&&r.status==="review"&&e.jsxs(e.Fragment,{children:[e.jsxs(Y,{onClick:Ze,disabled:j||g,children:[e.jsx(le,{className:"w-4 h-4 me-2 text-green-600"}),s("ordersList.confirmCompletion")]}),e.jsxs(Y,{onClick:Ge,disabled:j||g,children:[e.jsx(St,{className:"w-4 h-4 me-2 text-yellow-600"}),s("ordersList.requestRevision")]})]}),e.jsx(Y,{asChild:!0,children:e.jsxs(Se,{href:y?`/freelancer/orders/${r.id}`:`/client/orders/${r.id}`,className:"flex items-start",children:[e.jsx(oe,{className:"w-4 h-4 me-2"}),s("chatIndex.viewOrderDetails")]})})]})]})]}),g&&e.jsx(U.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-yellow-50 dark:bg-yellow-900/20 border-b border-yellow-200 dark:border-yellow-800 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(yt,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:s("chatIndex.chatDisabled")}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:tt()})]})]})}),e.jsxs(Ue,{className:"flex-1 p-4 bg-muted/10",children:[te.map((p,b)=>{var ge;const S=p.sender_id===t.user.id,W=p.sender||(S?t.user:N)||{};return e.jsx("div",{className:`flex mb-4 ${S?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex ${S?"flex-row-reverse":""} max-w-[80%]`,children:[!S&&e.jsxs(ye,{className:"h-8 w-8 mt-1",children:[e.jsx(je,{src:W.avatar}),e.jsx(Ne,{children:((ge=W.name)==null?void 0:ge.charAt(0))||e.jsx(_e,{})})]}),e.jsx("div",{className:`flex flex-col ${S?"me-2":"ms-2"} space-y-1`,children:p.messages.map((w,we)=>e.jsxs(U.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:`rounded-xl px-4 py-2 ${S?"bg-primary text-primary-foreground":"bg-card border"} ${we===0?"rounded-tl-none":""}`,children:[w.content&&e.jsx("p",{className:"whitespace-pre-wrap text-sm",children:w.content}),w.file_path&&e.jsx("div",{className:"mt-2",children:w.file_type==="image"?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:w.file_path.startsWith("http")?w.file_path:`/storage/${w.file_path}`,alt:"Attachment",className:"rounded-lg max-h-60 cursor-pointer",onClick:()=>C(w.file_path.startsWith("http")?w.file_path:`/storage/${w.file_path}`)}),e.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(M,{variant:"outline",size:"icon",className:"h-8 w-8 bg-background/80",onClick:rt=>{rt.stopPropagation(),window.open(w.file_path.startsWith("http")?w.file_path:`/storage/${w.file_path}`,"_blank")},children:e.jsx(Ee,{className:"h-4 w-4"})})})]}):e.jsxs("a",{href:w.file_path.startsWith("http")?w.file_path:`/storage/${w.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-2 bg-primary/10 rounded-lg hover:bg-muted/80 transition-colors",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:w.file_type==="final_delivery"?s("chatList.finalDeliverySubmitted"):s("chatIndex.downloadFile")})]})}),e.jsxs("div",{className:`flex items-center justify-end gap-1 mt-1 text-xs ${S?"text-primary-foreground/80":"text-muted-foreground"}`,children:[e.jsx("span",{children:Ke(w.created_at)}),S&&e.jsxs(Ce,{children:[e.jsx(Pe,{children:w.read_at?e.jsx(jt,{className:"h-3 w-3 ms-1"}):e.jsx(Nt,{className:"h-3 w-3 ms-1"})}),e.jsx(Re,{children:w.read_at?s("chatIndex.read"):s("chatIndex.sent")})]})]})]},w.id||we))})]})},b)}),n.length>0&&e.jsx("div",{ref:L})]}),e.jsx("div",{className:"border-t border-border p-3 bg-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"text-sm font-medium me-2",children:[s("chatIndex.orderStatus"),":"]}),e.jsx(re,{className:(be=ne[r.status])==null?void 0:be.color,children:e.jsxs("div",{className:"flex items-center space-x-1",children:[(ve=ne[r.status])==null?void 0:ve.icon,e.jsx("span",{children:s(`orders.status.${r.status}`)})]})})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s("chatIndex.orderNumber",{order:r.order_number})})]})}),e.jsxs("div",{className:"border-t border-border p-3 bg-card",children:[y&&r.status==="in_progress"&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs(M,{variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:ue,disabled:j||g,children:[e.jsx(q,{className:"h-4 w-4"})," ",s("chatIndex.deliverWork")]})}),c&&e.jsxs("div",{className:"flex items-center mb-3 bg-muted rounded px-3 py-2 relative",children:[u==="image"&&I?e.jsx("img",{src:I,alt:"Preview",className:"max-h-20 w-auto rounded me-2"}):e.jsx(oe,{className:"h-4 w-4 me-2"}),e.jsx("span",{className:"text-sm truncate max-w-xs",children:c.name}),e.jsx(M,{variant:"ghost",size:"icon",className:"ms-2 h-6 w-6 rounded-full",onClick:()=>{h(null),f(null),C(null)},disabled:g,children:e.jsx(se,{className:"h-4 w-4"})}),m&&e.jsx("span",{className:"ms-2 text-xs text-muted-foreground",children:s("chatIndex.uploading")})]}),e.jsxs("form",{onSubmit:Qe,className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",ref:D,onChange:Je,className:"hidden",accept:"image/*,.pdf,.doc,.docx,.zip",disabled:g}),e.jsxs(Ce,{children:[e.jsx(Pe,{asChild:!0,children:e.jsx(M,{type:"button",variant:"ghost",size:"icon",onClick:()=>D.current.click(),className:"rounded-full",disabled:g,children:e.jsx(At,{className:"h-5 w-5"})})}),e.jsx(Re,{children:s("chatIndex.attachFile")})]}),e.jsx(nt,{placeholder:s(g?"chatIndex.chatDisabledPlaceholder":"chatIndex.messagePlaceholder"),value:i,onChange:p=>d(p.target.value),className:"flex-1 rounded-full px-4 py-2 border-border bg-background focus-visible:ring-1 border ",disabled:m||g}),e.jsx(M,{type:"submit",size:"icon",disabled:m||!i.trim()&&!c||g,className:"rounded-full bg-primary hover:bg-primary/90",children:m?e.jsx(U.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(q,{className:"h-5 w-5"})}):e.jsx(q,{className:"h-5 w-5"})})]})]})]}),I&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:()=>C(null),children:e.jsxs("div",{className:"relative max-w-4xl w-full max-h-[90vh]",children:[e.jsx(M,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-10 h-10 w-10 rounded-full bg-background/80 hover:bg-background",onClick:()=>C(null),children:e.jsx(se,{className:"h-5 w-5"})}),e.jsx("img",{src:I,alt:"Preview",className:"w-full h-full object-contain"}),e.jsx("div",{className:"absolute bottom-4 right-4",children:e.jsxs(Se,{href:I,download:!0,className:"inline-flex items-center gap-2 px-4 py-2 bg-background rounded-full hover:bg-background/90 transition-colors",onClick:p=>p.stopPropagation(),children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{children:s("chatIndex.download")})]})})]})}),et&&e.jsx("div",{className:"p-4",children:e.jsx(bt,{orderId:r.id,onSuccess:()=>E.reload({only:["order"]})})}),he&&e.jsx("div",{className:"p-4 mt-6",children:e.jsx(vt,{review:he})})]})})}export{Ur as default};
